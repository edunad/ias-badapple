<body>
    <div class='wrapper'>
        <ui-frame style="width: 100%; height: 100%" title="BadApple" color="#000" bg-color="#ffe73a" draggable>
            <div id="apple-render" style='color:white;white-space: break-spaces;font-size: 10px;'>
            </div>
        </ui-frame>
    </div>

    <script type="text/javascript">
        function setup() {
            const render = document.getElementById("apple-render");
            if (!render) return;

            const apple = new Audio("https://ams3.digitaloceanspaces.com/failcake/public/badapple/caw.mp3");
            apple.autoplay = false;
            apple.volume = 0.2;
            apple.addEventListener("canplaythrough", (event) => {
                window.queryUI({
                    request: JSON.stringify({ event: 'ui_sound_ready' }),
                    persistent: false,
                    onSuccess: (response) => {
                        apple.play(); // Start it
                    },
                    onFailure: (errcode, errmsg) => { },
                });
            });

            // Listener
            window.queryUI({
                request: 'LISTENER_APPLE_DATA',
                persistent: true,
                onSuccess: (response) => {
                    if (!render) return;
                    render.innerText = JSON.parse(response).data;
                },
                onFailure: (errcode, errmsg) => { },
            });

            apple.load();
        };

        // Components loaded
        window.scriptLoaded = () => { setup(); };
    </script>
</body>